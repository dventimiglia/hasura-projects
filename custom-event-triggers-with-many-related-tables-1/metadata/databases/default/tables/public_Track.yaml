table:
  name: Track
  schema: public
object_relationships:
  - name: Album
    using:
      foreign_key_constraint_on: AlbumId
  - name: Genre
    using:
      foreign_key_constraint_on: GenreId
  - name: MediaType
    using:
      foreign_key_constraint_on: MediaTypeId
array_relationships:
  - name: InvoiceLines
    using:
      foreign_key_constraint_on:
        column: TrackId
        table:
          name: InvoiceLine
          schema: public
  - name: PlaylistTracks
    using:
      foreign_key_constraint_on:
        column: TrackId
        table:
          name: PlaylistTrack
          schema: public
event_triggers:
  - name: insert_update_track
    definition:
      enable_manual: true
      insert:
        columns: '*'
      update:
        columns: '*'
    retry_conf:
      interval_sec: 10
      num_retries: 0
      timeout_sec: 60
    webhook: http://solr:8983/solr
    request_transform:
      body:
        action: transform
        template: |-
          [{
          "id": {{$body.event.data.new.TrackId}},
          "name": {{$body.event.data.new.Name}}
          }]
      method: POST
      query_params: commitWithin=1000&overwrite=true&wt=json
      template_engine: Kriti
      url: '{{$base_url}}/track/update'
      version: 2
